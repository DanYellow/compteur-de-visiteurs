services:
    traefik:
        image: traefik:v3
        container_name: traefik
        command:
            - --api.insecure=true
            - --providers.docker=true
            - --providers.docker.exposedByDefault=false
            # - --providers.file.filename=/traefik-dynamic.yml
        ports:
            - "80:80"
            - "8080:8080"
        volumes:
            - "/var/run/docker.sock:/var/run/docker.sock:ro"
        # configs:
        #     - traefik-dynamic.yml
        networks:
            - web

    compteur-de-visiteurs:
        # image: node:22.19.0-alpine
        image: node:24.8.0
        container_name: compteur-social-dev
        command: sh -c "npm install && npm run dev:docker" # --verbose
        working_dir: "/home/node/app"
        depends_on:
            - traefik
        volumes:
            # - .:/home/node/app/
            - ./public/:/home/node/app/public
            - ./src/:/home/node/app/src
            - ./server:/home/node/app/server
            - ./package.json:/home/node/app/package.json
            - ./.env.local:/home/node/app/.env.local
            - ./package-lock.json:/home/node/app/package-lock.json
            # - ./message.tmp.csv:/home/node/app/message.tmp.csv
            - ./vite.config.ts:/home/node/app/vite.config.ts
            - ./tsconfig.json:/home/node/app/tsconfig.json
            - /home/node/app/node_modules
        ports:
            - 3900:3900
            - 24678:24678
        # restart: always
        environment:
            - VITE_USE_POLLING=true
            - NODE_ENV=development
            - CHOKIDAR_USEPOLLING=true
        env_file:
            - .env.local
        labels:
            - "traefik.enable=true"
            - traefik.http.routers.compteur-de-visiteurs.rule=Host(`faclab.localhost`)
        networks:
            - web

networks:
  web:
    external: true
